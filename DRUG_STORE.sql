DROP DATABASE IF EXISTS DRUG_STORE;
CREATE DATABASE DRUG_STORE;
USE DRUG_STORE;

CREATE TABLE DRUG(
TRADE_NAME VARCHAR(20),
PRIMARY KEY (TRADE_NAME));

ALTER TABLE DRUG
RENAME TO MEDICINE;

CREATE TABLE DRUG_MANUFACTURE(
COMPANY_ID INT,
NAME VARCHAR(20) NOT NULL,
ADDRESS VARCHAR(50) NOT NULL,
PRIMARY KEY(COMPANY_ID));

ALTER TABLE drug_manufacture
MODIFY ADDRESS VARCHAR(100);

CREATE TABLE PATIENT(
PID INT,
NAME VARCHAR(20),
ADDRESS VARCHAR(50),
SEX CHAR(1) CHECK (SEX IN ('M', 'F','O')),
INSURANCE_INFO VARCHAR(50) NOT NULL,
PRIMARY KEY (PID));

INSERT INTO PATIENT (PID, NAME, ADDRESS, SEX, INSURANCE_INFO)
VALUES (101, 'Praveen Patil', '123 Maple St, Solapur', 'M', 'United Health PPO'),
(102, 'Suman Jain', '456 Oak Ave, Pune', 'F', 'Blue Cross Shield HMO');

ALTER TABLE PATIENT
ADD AGE INT; 

UPDATE PATIENT
SET AGE = 32
WHERE PID = 101;

UPDATE PATIENT
SET AGE = 23
WHERE PID = 102;

DELETE FROM PATIENT WHERE PID = 102;

CREATE TABLE DOCTOR(
PHYS_ID VARCHAR(20),
D_NAME VARCHAR(20) NOT NULL,
SPECIALITY VARCHAR(15),
PRIMARY KEY (PHYS_ID));

ALTER TABLE DOCTOR
MODIFY SPECIALITY VARCHAR(50);

CREATE TABLE EMPLOYEE(
EMPLOYEE_ID VARCHAR(25),
NAME VARCHAR(30) NOT NULL,
PRIMARY KEY (EMPLOYEE_ID));

CREATE TABLE PHARMACY(
PHAR_ID VARCHAR(30),
NAME VARCHAR(20),
FAX INT NOT NULL,
ADDRESS VARCHAR(50),
PRIMARY KEY (PHAR_ID));

ALTER TABLE PHARMACY
MODIFY FAX BIGINT;

CREATE TABLE SELL(
PRICE FLOAT,
PHAR_ID VARCHAR(30),
TRADE_NAME VARCHAR(20),
FOREIGN KEY (TRADE_NAME) REFERENCES MEDICINE (TRADE_NAME),
FOREIGN KEY (PHAR_ID) REFERENCES PHARMACY (PHAR_ID));

CREATE TABLE CONTRACT(
START_DATE DATE,
END_DATE DATE,
COMPANY_ID INT,
PHAR_ID VARCHAR(30),
FOREIGN KEY (COMPANY_ID) REFERENCES DRUG_MANUFACTURE (COMPANY_ID),
FOREIGN KEY (PHAR_ID) REFERENCES PHARMACY (PHAR_ID));

CREATE TABLE MAKE(
COMPANY_ID INT,
TRADE_NAME VARCHAR(20),
FOREIGN KEY (COMPANY_ID) REFERENCES DRUG_MANUFACTURE (COMPANY_ID),
FOREIGN KEY (TRADE_NAME) REFERENCES MEDICINE (TRADE_NAME));

CREATE TABLE SEEN_BY(
PID INT,
PHYS_ID VARCHAR(20),
FOREIGN KEY (PID) REFERENCES PATIENT (PID),
FOREIGN KEY (PHYS_ID) REFERENCES DOCTOR (PHYS_ID));

CREATE TABLE WORKS(
SHIFT_START TIME,
SHIFT_END TIME,
EMPLOYEE_ID VARCHAR(25),
PHAR_ID VARCHAR(30),
FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEE (EMPLOYEE_ID),
FOREIGN KEY (PHAR_ID) REFERENCES PHARMACY (PHAR_ID));

CREATE TABLE PRESCRIBE(
DATE DATE,
QUANTITY INT,
PHYS_ID VARCHAR(20),
PID INT,
TRADE_NAME VARCHAR(20),
FOREIGN KEY (PHYS_ID) REFERENCES DOCTOR (PHYS_ID),
FOREIGN KEY (PID) REFERENCES PATIENT (PID),
FOREIGN KEY (TRADE_NAME) REFERENCES MEDICINE (TRADE_NAME)); 

CREATE TABLE TRANSPORTER(
TransID INT PRIMARY KEY,
TransName VARCHAR(50));

INSERT INTO DRUG_MANUFACTURE (COMPANY_ID, NAME, ADDRESS) VALUES
(1, 'Cipla Ltd', 'Cipla House, Peninsula Business Park, Mumbai'),
(2, 'Sun Pharma', 'Sun House, Western Express Highway, Mumbai'),
(3, 'Dr. Reddy''s Labs', '8-2-337, Road No. 3, Banjara Hills, Hyderabad'),
(4, 'Lupin Limited', 'Kalpataru Inspire, Off Western Express Highway, Mumbai'),
(5, 'Zydus Cadila', 'Sarkhej-Dholka Road, Bhat, Ahmedabad');

INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Paracetamol');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Amoxicillin');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Ibuprofen');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Aspirin');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Atorvastatin');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Metformin');
INSERT INTO MEDICINE (TRADE_NAME) VALUES ('Omeprazole');

INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (1, 'Paracetamol');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (1, 'Amoxicillin');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (2, 'Ibuprofen');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (3, 'Aspirin');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (4, 'Atorvastatin');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (5, 'Metformin');
INSERT INTO MAKE (COMPANY_ID, TRADE_NAME) VALUES (5, 'Omeprazole');

INSERT INTO PATIENT (PID, NAME, ADDRESS, SEX, INSURANCE_INFO, AGE) VALUES
(201, 'Rohan Sharma', '15 FC Road, Pune', 'M', 'Star Health Gold', 35),
(202, 'Priya Singh', '21 MG Road, Bangalore', 'F', 'HDFC Ergo Optima', 28),
(203, 'Amit Patel', '10 C.G. Road, Ahmedabad', 'M', 'ICICI Lombard Complete', 45),
(204, 'Sneha Reddy', '5 Jubilee Hills, Hyderabad', 'F', 'Bajaj Allianz Silver', 32),
(205, 'Vikram Kumar', '8 Marine Drive, Mumbai', 'M', 'Max Bupa Health Companion', 50);

INSERT INTO DOCTOR (PHYS_ID, D_NAME, SPECIALITY) VALUES
('DOC101', 'Dr. Anjali Rao', 'Cardiologist'),
('DOC102', 'Dr. Sameer Verma', 'Pediatrician'),
('DOC103', 'Dr. Neha Desai', 'Dermatologist'),
('DOC104', 'Dr. Rajesh Gupta', 'Orthopedic'),
('DOC105', 'Dr. Meera Iyer', 'General Physician');

INSERT INTO EMPLOYEE (EMPLOYEE_ID, NAME) VALUES
('EMP201', 'Ankit Joshi'),
('EMP202', 'Bhavna Mehta'),
('EMP203', 'Chetan Shah'),
('EMP204', 'Divya Nair'),
('EMP205', 'Farhan Khan');

INSERT INTO PHARMACY (PHAR_ID, NAME, FAX, ADDRESS) VALUES
('PHARM01', 'Apollo Pharmacy', 2026543210, 'J.M. Road, Pune'),
('PHARM02', 'Wellness Forever', 2229876543, 'Bandra West, Mumbai'),
('PHARM03', 'MedPlus', 4023456789, 'Hitech City, Hyderabad'),
('PHARM04', 'Noble Medicals', 2025551234, 'Koregaon Park, Pune'),
('PHARM05', 'Frank Ross', 3322114455, 'Park Street, Kolkata');

INSERT INTO SELL (PRICE, PHAR_ID, TRADE_NAME) VALUES
(15.50, 'PHARM01', 'Paracetamol'),
(25.00, 'PHARM01', 'Ibuprofen'),
(8.75, 'PHARM02', 'Aspirin'),
(55.20, 'PHARM03', 'Atorvastatin'),
(12.00, 'PHARM05', 'Omeprazole');

INSERT INTO CONTRACT (START_DATE, END_DATE, COMPANY_ID, PHAR_ID) VALUES
('2023-01-01', '2025-12-31', 1, 'PHARM01'),
('2022-06-01', '2024-05-31', 2, 'PHARM02'),
('2023-03-15', '2025-03-14', 3, 'PHARM03'),
('2024-01-01', '2026-12-31', 5, 'PHARM01'),
('2023-07-01', '2025-06-30', 4, 'PHARM04');

INSERT INTO SEEN_BY (PID, PHYS_ID) VALUES
(101, 'DOC105'),
(201, 'DOC101'),
(202, 'DOC103'),
(203, 'DOC104'),
(204, 'DOC105');

INSERT INTO WORKS (SHIFT_START, SHIFT_END, EMPLOYEE_ID, PHAR_ID) VALUES
('08:00:00', '16:00:00', 'EMP201', 'PHARM01'),
('14:00:00', '22:00:00', 'EMP202', 'PHARM01'),
('09:00:00', '17:00:00', 'EMP203', 'PHARM02'),
('10:00:00', '18:00:00', 'EMP204', 'PHARM03'),
('08:30:00', '16:30:00', 'EMP205', 'PHARM04');

INSERT INTO PRESCRIBE (DATE, QUANTITY, PHYS_ID, PID, TRADE_NAME) VALUES
('2024-10-15', 30, 'DOC101', 201, 'Atorvastatin'),
('2024-10-16', 1, 'DOC103', 202, 'Omeprazole'),
('2024-10-17', 1, 'DOC105', 101, 'Paracetamol'),
('2024-10-18', 60, 'DOC104', 203, 'Ibuprofen'),
('2024-10-19', 14, 'DOC105', 204, 'Amoxicillin');

INSERT INTO TRANSPORTER (TransID, TransName) VALUES
(1, 'Delhivery Pharma'),
(2, 'Blue Dart Medical'),
(3, 'QuickRun Logistics'),
(4, 'SafeTrans Health'),
(5, 'India Post Pharma');

SELECT * FROM DRUG_MANUFACTURE;
SELECT * FROM PATIENT;

SELECT COUNT(AGE)
FROM PATIENT
WHERE AGE BETWEEN 30 and 45;

SELECT COUNT(AGE)
FROM PATIENT
WHERE AGE >= 30 AND AGE <= 45;

SELECT DISTINCT SPECIALITY AS Profession
FROM DOCTOR
WHERE PHYS_ID >= 'DOC101' AND PHYS_ID <= 'DOC103';

SELECT COUNT(DISTINCT SPECIALITY) AS Num_Profession
FROM DOCTOR
WHERE PHYS_ID >= 'DOC101' AND PHYS_ID <= 'DOC103';

SELECT NAME, EMPLOYEE_ID
FROM EMPLOYEE ORDER BY NAME DESC;

SELECT PHAR_ID, FAX
FROM PHARMACY ORDER BY FAX;

SELECT NAME, AGE
FROM PATIENT ORDER BY NAME;

SELECT PHYS_ID, SPECIALITY
FROM DOCTOR
WHERE PHYS_ID IN ('DOC101', 'DOC103', 'DOC105');

SELECT NAME, EMPLOYEE_ID
FROM EMPLOYEE
WHERE EMPLOYEE_ID NOT IN ('EMP202', 'EMP204'); 

SELECT AVG(AGE) AS Avg_AGE
FROM PATIENT;

SELECT DISTINCT PHAR_ID, ADDRESS
FROM PHARMACY
WHERE ADDRESS LIKE '%Pune%'; 

SELECT PHAR_ID, ADDRESS
FROM PHARMACY
WHERE ADDRESS LIKE '%Mumbai%'; 

SELECT PID, NAME, AGE
FROM PATIENT
WHERE AGE > (
SELECT AVG(AGE)
FROM PATIENT);

SELECT PHAR_ID, NAME, ADDRESS
FROM PHARMACY
WHERE ADDRESS LIKE '%Pune%';

CREATE VIEW Medicine_Manufacturers AS
SELECT m.TRADE_NAME, d.NAME AS COMPANY_NAME, d.ADDRESS AS COMPANY_ADDRESS
FROM MAKE mk
JOIN MEDICINE m ON mk.TRADE_NAME = m.TRADE_NAME
JOIN DRUG_MANUFACTURE d ON mk.COMPANY_ID = d.COMPANY_ID;

SELECT d.D_NAME, d.SPECIALITY, p.NAME AS Patient_Name
FROM DOCTOR d
LEFT JOIN SEEN_BY sb ON d.PHYS_ID = sb.PHYS_ID
LEFT JOIN PATIENT p ON sb.PID = p.PID;

SELECT * FROM MAKE;

